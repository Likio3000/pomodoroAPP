{% extends "base.html" %}
{% block content %}
  <h2 class="dashboard-main-title">My Data</h2>
  <p>Below is your stored chat history. You can delete individual messages.</p>

  {% if messages %}
    <ul class="chat-history">
      {% for msg in messages %}
        <li class="chat-history-item">
          <div>
            <strong>{{ msg.role.title() }}</strong>
            <em>{{ msg.timestamp.isoformat() if msg.timestamp else '' }}</em>

            {# ONE form, ONE token, ONE button #}
            <form action="{{ url_for('main.delete_message', message_id=msg.id) }}"
                  method="post"
                  style="display:inline;margin-left:1em;"
                  onsubmit="return confirm('Delete this message?');">
              <!-- hidden CSRF field so Flask-WTF receives it -->
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
            {% if msg.role == 'user' %}
            <form action="{{ url_for('main.delete_message_pair', message_id=msg.id) }}"
                  method="post"
                  style="display:inline;margin-left:0.5em;"
                  onsubmit="return confirm('Delete this message and its pair?');">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-sm btn-warning">Delete Pair</button>
            </form>
            {% endif %}
          </div>

          <div class="chat-text">{{ msg.text }}</div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No chat history stored.</p>
  {% endif %}
{% endblock %}
